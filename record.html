<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ‹ï¸â€â™€ï¸ Workout æœˆç´¯ç©è¨˜éŒ„</title>

  <style>
    body {
      font-family: "Noto Sans TC", Arial, sans-serif;
      margin: 0;
      background: #fafafa;
      color: #333;
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 10px;
      font-size: 1.8rem;
    }
    .selector {
      text-align: center;
      margin: 15px 0;
    }
    select {
      font-size: 1rem;
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    .table-container {
      overflow-x: auto;
      margin: 0 auto;
      max-width: 100%;
      background: white;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
      border-radius: 12px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      min-width: 600px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
      white-space: nowrap;
    }
    th {
      background-color: #f2f2f2;
      font-weight: bold;
    }

    .chart-container {
      width: 100%;
      max-width: 800px;
      margin: 20px auto;
      background: #fff;
      padding: 10px;
      border-radius: 12px;
      box-shadow: 0 0 6px rgba(0,0,0,0.05);
    }

    canvas {
      width: 100% !important;
      height: auto !important;
    }

    @media (max-width: 768px) {
      h1 { font-size: 1.5rem; }
      th, td { padding: 6px; font-size: 0.9rem; }
    }
  </style>
</head>
<body>
  <h1>ğŸ‹ï¸â€â™€ï¸ Workout æœˆç´¯ç©è¨˜éŒ„</h1>

  <div class="selector">
    <label for="chartSelect">é¸æ“‡è¦é¡¯ç¤ºçš„é …ç›®ï¼š</label>
    <select id="chartSelect">
      <option value="all">å…¨éƒ¨é¡¯ç¤º</option>
      <option value="compare">ğŸ“Š å…¨é …ç›®æ¯”è¼ƒ</option>
      <option value="0">è·‘æ­¥ (min)</option>
      <option value="1">é‡é‡è¨“ç·´ (sets)</option>
      <option value="2">å£çƒ (min)</option>
      <option value="3">æ•™ç·´æŒ‡å®šä½œæ¥­ (sets)</option>
      <option value="4">å¥è¡Œ (min)</option>
      <option value="5">ç‘œä¼½ (sessions)</option>
    </select>
  </div>

  <div class="table-container">
    <table id="dataTable">
      <thead>
        <tr>
          <th>æ—¥æœŸ</th>
          <th>è·‘æ­¥ (min)</th>
          <th>é‡é‡è¨“ç·´ (sets)</th>
          <th>å£çƒ (min)</th>
          <th>æ•™ç·´æŒ‡å®šä½œæ¥­ (sets)</th>
          <th>å¥è¡Œ (min)</th>
          <th>ç‘œä¼½ (sessions)</th>
          <th>å‚™è¨»</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="charts"></div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const SHEET_ID = "1LFtkrReXYpFL1W51QZkRf7Az4ZMfxB1eBu2a3YQ0hzY";
    const SHEET_NAME = "sheet1";
    const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(SHEET_NAME)}&tqx=out:json`;

    const chartNames = [
      "è·‘æ­¥ (min)",
      "é‡é‡è¨“ç·´ (sets)",
      "å£çƒ (min)",
      "æ•™ç·´æŒ‡å®šä½œæ¥­ (sets)",
      "å¥è¡Œ (min)",
      "ç‘œä¼½ (sessions)"
    ];
    const colors = ["#4CAF50", "#2196F3", "#FF9800", "#9C27B0", "#795548", "#E91E63"];
    const charts = [];

    fetch(url)
      .then(res => res.text())
      .then(text => {
        const json = JSON.parse(text.substring(47, text.length - 2));
        const rows = json.table.rows;
        const tbody = document.querySelector("#dataTable tbody");

        const monthlyData = {};

        rows.forEach(row => {
          const tr = document.createElement("tr");
          const validCells = row.c.filter(cell => cell && cell.v !== undefined);
          validCells.forEach(cell => {
            const td = document.createElement("td");
            td.textContent = cell.v ?? "";
            tr.appendChild(td);
          });
          tbody.appendChild(tr);

          const dateStr = row.c[0]?.v || "";
          const values = row.c.slice(1, 7).map(c => Number(c?.v || 0));

          let dateObj;
          try {
            dateObj = new Date(dateStr);
            if (isNaN(dateObj)) return;
          } catch {
            return;
          }

          const monthKey = `${dateObj.getFullYear()}-${String(dateObj.getMonth() + 1).padStart(2, "0")}`;
          if (!monthlyData[monthKey]) monthlyData[monthKey] = [0, 0, 0, 0, 0, 0];
          for (let i = 0; i < 6; i++) monthlyData[monthKey][i] += values[i];
        });

        const labels = Object.keys(monthlyData);
        const dataArrays = [0,1,2,3,4,5].map(i => labels.map(m => monthlyData[m][i]));
        const chartContainer = document.getElementById("charts");

        // å„é …ç›®å–®ç¨åœ–è¡¨
        chartNames.forEach((name, i) => {
          const div = document.createElement("div");
          div.className = "chart-container";
          div.dataset.index = i;
          const canvas = document.createElement("canvas");
          div.appendChild(canvas);
          chartContainer.appendChild(div);

          const chart = new Chart(canvas.getContext("2d"), {
            type: "line",
            data: {
              labels,
              datasets: [{
                label: name,
                data: dataArrays[i],
                borderColor: colors[i],
                backgroundColor: colors[i] + "33",
                borderWidth: 2,
                tension: 0.2,
                fill: true,
                pointRadius: 3
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                title: { display: true, text: "ğŸ“… æ¯æœˆ " + name + " ç´¯ç©" }
              },
              scales: {
                x: { title: { display: true, text: "æœˆä»½" } },
                y: { beginAtZero: true }
              }
            }
          });
          charts.push({ div, chart });
        });

        // å…¨é …ç›®æ¯”è¼ƒåœ–
        const compareDiv = document.createElement("div");
        compareDiv.className = "chart-container";
        compareDiv.dataset.index = "compare";
        const compareCanvas = document.createElement("canvas");
        compareDiv.appendChild(compareCanvas);
        chartContainer.appendChild(compareDiv);

        const compareChart = new Chart(compareCanvas.getContext("2d"), {
          type: "line",
          data: {
            labels,
            datasets: chartNames.map((name, i) => ({
              label: name,
              data: dataArrays[i],
              borderColor: colors[i],
              backgroundColor: colors[i] + "33",
              borderWidth: 2,
              tension: 0.2,
              fill: false,
              pointRadius: 2
            }))
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: { display: true, text: "ğŸ“Š å„é …é‹å‹•æœˆç´¯ç©æ¯”è¼ƒåœ–" },
              legend: { position: "bottom" }
            },
            scales: {
              x: { title: { display: true, text: "æœˆä»½" } },
              y: { beginAtZero: true }
            }
          }
        });

        charts.push({ div: compareDiv, chart: compareChart });

        // ä¸‹æ‹‰é¸å–®æ§åˆ¶
        document.getElementById("chartSelect").addEventListener("change", e => {
          const value = e.target.value;
          charts.forEach(({ div }, idx) => {
            div.style.display =
              value === "all" ||
              value === "compare" && div.dataset.index === "compare" ||
              value == idx
                ? "block"
                : "none";
          });
        });
      })
      .catch(err => {
        console.error("è®€å–éŒ¯èª¤ï¼š", err);
        document.querySelector("#dataTable tbody").innerHTML =





